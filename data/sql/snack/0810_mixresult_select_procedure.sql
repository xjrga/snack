CREATE PROCEDURE MixResult_Select (
IN v_MixId LONGVARCHAR,
IN v_Precision INTEGER
)
MODIFIES SQL DATA DYNAMIC RESULT SETS 1 BEGIN ATOMIC
DECLARE result CURSOR
FOR
SELECT a.MixId,
       a.FoodId,
       b.Name,
       ROUND(a.Weight,v_Precision) AS Weight,
       ROUND(CompleteProtein,v_Precision) AS CompleteProtein,
       ROUND(DigestibleCarbohydrate,v_Precision) AS DigestibleCarbohydrate,
       ROUND(Cost,v_Precision) AS Cost,
       ROUND(Protein,v_Precision) AS Protein,
       ROUND(Fat,v_Precision) AS Fat,
       ROUND(CarbsByDiff,v_Precision) AS CarbsByDiff,
       ROUND(energygross,v_Precision) AS EnergyGross,
       ROUND(Alcohol,v_Precision) AS Alcohol,
       ROUND(Water,v_Precision) AS Water,
       ROUND(Fiber,v_Precision) AS Fiber,
       ROUND(Calcium,v_Precision) AS Calcium,
       ROUND(Iron,v_Precision) AS Iron,
       ROUND(Magnesium,v_Precision) AS Magnesium,
       ROUND(Phosphorus,v_Precision) AS Phosphorus,
       ROUND(Potassium,v_Precision) AS Potassium,
       ROUND(Sodium,v_Precision) AS Sodium,
       ROUND(Zinc,v_Precision) AS Zinc,
       ROUND(Copper,v_Precision) AS Copper,       
       ROUND(Manganese,v_Precision) AS Manganese,
       ROUND(Selenium,v_Precision) AS Selenium,
       ROUND(VitaminA,v_Precision) AS VitaminA,
       ROUND(VitaminE,v_Precision) AS VitaminE,
       ROUND(VitaminD,v_Precision) AS VitaminD,
       ROUND(VitaminC,v_Precision) AS VitaminC,
       ROUND(Thiamin,v_Precision) AS Thiamin,
       ROUND(Riboflavin,v_Precision) AS Riboflavin,
       ROUND(Niacin,v_Precision) AS Niacin,
       ROUND(pantothenicacid,v_Precision) AS Pantothenic,
       ROUND(VitaminB6,v_Precision) AS VitaminB6,
       ROUND(VitaminB12,v_Precision) AS VitaminB12,
       ROUND(Choline,v_Precision) AS Choline,
       ROUND(VitaminK,v_Precision) AS VitaminK,
       ROUND(Folate,v_Precision) AS Folate,
       ROUND(Cholesterol,v_Precision) AS Cholesterol,
       ROUND(sfa,v_Precision) AS Saturated,
       ROUND(DHA,v_Precision) AS DHA,
       ROUND(EPA,v_Precision) AS EPA,
       ROUND(mufa,v_Precision) AS Monounsaturated,
       ROUND(pufa,v_Precision) AS Polyunsaturated,
       ROUND(linoleicacid,v_Precision) AS Linoleic,
       ROUND(alphalinolenicacid,v_Precision) AS AlphaLinolenic,
       ROUND(GlycemicLoad,v_Precision) AS GlycemicLoad,
       ROUND(EnergyDigestible,v_Precision) AS EnergyDigestible,
       ROUND(EnergyCarbohydrate,v_Precision) AS EnergyCarbohydrate,
       ROUND(EnergyProtein,v_Precision) AS EnergyProtein,
       ROUND(EnergyFat,v_Precision) AS EnergyFat,
       ROUND(EnergyAlcohol,v_Precision) AS EnergyAlcohol,
       ROUND(EnergyFatCarbohydrate,v_Precision) AS EnergyFatCarbohydrate
FROM mixresultdn a,
     food b
WHERE a.mixid = v_mixid
AND   a.foodid = b.foodid
--
union
--
select a.MixId,
       '',
       'Total',
       Round(sum(a.Weight),v_Precision),
       Round(sum(CompleteProtein),v_Precision),       
       Round(sum(DigestibleCarbohydrate),v_Precision),
       Round(sum(Cost),v_Precision),
       Round(sum(Protein),v_Precision),
       Round(sum(Fat),v_Precision),
       Round(sum(CarbsByDiff),v_Precision),
       Round(sum(energygross),v_Precision),
       Round(sum(Alcohol),v_Precision),
       Round(sum(Water),v_Precision),
       Round(sum(Fiber),v_Precision),
       Round(sum(Calcium),v_Precision),
       Round(sum(Iron),v_Precision),
       Round(sum(Magnesium),v_Precision),
       Round(sum(Phosphorus),v_Precision),
       Round(sum(Potassium),v_Precision),
       Round(sum(Sodium),v_Precision),
       Round(sum(Zinc),v_Precision),
       Round(sum(Copper),v_Precision),      
       Round(sum(Manganese),v_Precision),
       Round(sum(Selenium),v_Precision),
       Round(sum(VitaminA),v_Precision),
       Round(sum(VitaminE),v_Precision),
       Round(sum(VitaminD),v_Precision),
       Round(sum(VitaminC),v_Precision),
       Round(sum(Thiamin),v_Precision),
       Round(sum(Riboflavin),v_Precision),
       Round(sum(Niacin),v_Precision),
       Round(sum(pantothenicacid),v_Precision),
       Round(sum(VitaminB6),v_Precision),
       Round(sum(VitaminB12),v_Precision),
       Round(sum(Choline),v_Precision),
       Round(sum(VitaminK),v_Precision),
       Round(sum(Folate),v_Precision),
       Round(sum(Cholesterol),v_Precision),
       Round(sum(sfa),v_Precision),
       Round(sum(DHA),v_Precision),
       Round(sum(EPA),v_Precision),
       Round(sum(mufa),v_Precision),
       Round(sum(pufa),v_Precision),
       Round(sum(linoleicacid),v_Precision),
       Round(sum(alphalinolenicacid),v_Precision),
       Round(sum(GlycemicLoad),v_Precision),
       Round(sum(EnergyDigestible),v_Precision),       
       Round(sum(EnergyCarbohydrate),v_Precision),
       Round(sum(EnergyProtein),v_Precision),
       Round(sum(EnergyFat),v_Precision),
       Round(sum(EnergyAlcohol),v_Precision),
       ROUND(sum(EnergyFatCarbohydrate),v_Precision) AS EnergyFatCarbohydrate
FROM mixresultdn a,
     food b
WHERE a.mixid = v_mixid
AND   a.foodid = b.foodid
group by a.MixId
order by a.EnergyDigestible,a.Weight,b.Name;
--
OPEN result;
END;
/