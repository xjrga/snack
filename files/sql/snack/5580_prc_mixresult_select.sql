CREATE PROCEDURE MixResult_Select (IN v_MixId LONGVARCHAR) MODIFIES SQL DATA DYNAMIC RESULT SETS 1 BEGIN ATOMIC DECLARE result CURSOR
FOR
--
SELECT mix_id,
       food_id,
       food_name,
       other_weight,
       energy_gross,
       energy_digestible,
       energy_fat,
       energy_carbohydrate,
       energy_fat_and_carbohydrate,
       energy_protein,
       energy_alcohol,
       fats_total,
       carbohydrates_digestible,
       protein_total,
       other_alcohol,
       energy_protein,
       protein_total,
       protein_complete,
       energy_fat,
       fats_total,
       fats_monounsaturated,
       fats_polyunsaturated,
       fats_saturated,
       fats_cholesterol,
       fats_saturated,
       fats_hcsfa,
       fats_lauric,
       fats_myristic,
       fats_palmitic,
       fats_stearic,
       fats_polyunsaturated,
       fats_linoleic,
       fats_linolenic,
       fats_epa,
       fats_dha,
       fats_lcn3pufa,
       energy_carbohydrate,
       carbohydrates_carbs_by_diff,
       carbohydrates_fiber,
       carbohydrates_fiber_insoluble,
       carbohydrates_fiber_soluble,
       carbohydrates_digestible,
       carbohydrates_starch,
       carbohydrates_sugars,
       carbohydrates_sucrose,
       carbohydrates_lactose,
       carbohydrates_fructose,
       carbohydrates_glucose,
       carbohydrates_glycemic_load,
       vitamins_vitamin_a,
       vitamins_vitamin_d,
       vitamins_vitamin_e,
       vitamins_vitamin_c,
       vitamins_thiamin,
       vitamins_riboflavin,
       vitamins_niacin,
       vitamins_vitamin_b6,
       vitamins_folate,
       vitamins_vitamin_b12,
       vitamins_vitamin_k,
       vitamins_pantothenic_acid,
       vitamins_choline,
       minerals_calcium,
       minerals_phosphorus,
       minerals_magnesium,
       minerals_iron,
       minerals_zinc,
       minerals_copper,
       minerals_manganese,
       minerals_selenium,
       minerals_potassium,
       minerals_sodium,
       phytonutrients_flavonoids,
       phytonutrients_anthocyanins,
       phytonutrients_carotenoids,
       phytonutrients_flavanols,
       phytonutrients_flavanones,
       phytonutrients_flavones,
       phytonutrients_flavonols,
       phytonutrients_isoflavones,
       phytonutrients_phytosterols,
       phytonutrients_beta_carotene,
       phytonutrients_lutein_zeaxanthin,
       phytonutrients_lycopene,
       phytonutrients_caffeine,
       phytonutrients_theobromine,
       other_cost,
       other_water
FROM DnMixResult a,
     food b
WHERE a.mix_id = v_MixId
AND   a.food_id = b.foodid
UNION
SELECT a.mix_id,
       '',
       'Total',
       SUM(other_weight),
       SUM(energy_gross),
       SUM(energy_digestible),
       SUM(energy_fat),
       SUM(energy_carbohydrate),
       SUM(energy_fat_and_carbohydrate),
       SUM(energy_protein),
       SUM(energy_alcohol),
       SUM(fats_total),
       SUM(carbohydrates_digestible),
       SUM(protein_total),
       SUM(other_alcohol),
       SUM(energy_protein),
       SUM(protein_total),
       SUM(protein_complete),
       SUM(energy_fat),
       SUM(fats_total),
       SUM(fats_monounsaturated),
       SUM(fats_polyunsaturated),
       SUM(fats_saturated),
       SUM(fats_cholesterol),
       SUM(fats_saturated),
       SUM(fats_hcsfa),
       SUM(fats_lauric),
       SUM(fats_myristic),
       SUM(fats_palmitic),
       SUM(fats_stearic),
       SUM(fats_polyunsaturated),
       SUM(fats_linoleic),
       SUM(fats_linolenic),
       SUM(fats_epa),
       SUM(fats_dha),
       SUM(fats_lcn3pufa),
       SUM(energy_carbohydrate),
       SUM(carbohydrates_carbs_by_diff),
       SUM(carbohydrates_fiber),
       SUM(carbohydrates_fiber_insoluble),
       SUM(carbohydrates_fiber_soluble),
       SUM(carbohydrates_digestible),
       SUM(carbohydrates_starch),
       SUM(carbohydrates_sugars),
       SUM(carbohydrates_sucrose),
       SUM(carbohydrates_lactose),
       SUM(carbohydrates_fructose),
       SUM(carbohydrates_glucose),
       SUM(carbohydrates_glycemic_load),
       SUM(vitamins_vitamin_a),
       SUM(vitamins_vitamin_d),
       SUM(vitamins_vitamin_e),
       SUM(vitamins_vitamin_c),
       SUM(vitamins_thiamin),
       SUM(vitamins_riboflavin),
       SUM(vitamins_niacin),
       SUM(vitamins_vitamin_b6),
       SUM(vitamins_folate),
       SUM(vitamins_vitamin_b12),
       SUM(vitamins_vitamin_k),
       SUM(vitamins_pantothenic_acid),
       SUM(vitamins_choline),
       SUM(minerals_calcium),
       SUM(minerals_phosphorus),
       SUM(minerals_magnesium),
       SUM(minerals_iron),
       SUM(minerals_zinc),
       SUM(minerals_copper),
       SUM(minerals_manganese),
       SUM(minerals_selenium),
       SUM(minerals_potassium),
       SUM(minerals_sodium),
       SUM(phytonutrients_flavonoids),
       SUM(phytonutrients_anthocyanins),
       SUM(phytonutrients_carotenoids),
       SUM(phytonutrients_flavanols),
       SUM(phytonutrients_flavanones),
       SUM(phytonutrients_flavones),
       SUM(phytonutrients_flavonols),
       SUM(phytonutrients_isoflavones),
       SUM(phytonutrients_phytosterols),
       SUM(phytonutrients_beta_carotene),
       SUM(phytonutrients_lutein_zeaxanthin),
       SUM(phytonutrients_lycopene),
       SUM(phytonutrients_caffeine),
       SUM(phytonutrients_theobromine),
       SUM(other_cost),
       SUM(other_water)
FROM DnMixResult a,
     food b
WHERE a.mix_id = v_MixId
AND   a.food_id = b.foodid
GROUP BY a.mix_id
ORDER BY energy_digestible, food_id desc;

--
OPEN result;

END;
/
