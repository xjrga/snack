CREATE PROCEDURE MixResult_Select (
IN v_MixId LONGVARCHAR
)
MODIFIES SQL DATA DYNAMIC RESULT SETS 1 BEGIN ATOMIC
DECLARE result CURSOR
FOR
SELECT 
a.mix_id,
a.food_id,
b.name,
carbohydrates_carbs_by_diff,
carbohydrates_fiber_insoluble,
carbohydrates_fiber_soluble,
carbohydrates_fiber,
carbohydrates_fructose,
carbohydrates_glucose,
carbohydrates_glycemic_load,
carbohydrates_lactose,
carbohydrates_starch,
carbohydrates_sucrose,
carbohydrates_sugars,
energy_gross,
fats_cholesterol,
fats_dha,
fats_epa,
fats_lauric,
fats_linoleic,
fats_linolenic,
fats_monounsaturated,
fats_myristic,
fats_palmitic,
fats_polyunsaturated,
fats_saturated,
fats_stearic,
fats_total,
minerals_calcium,
minerals_copper,
minerals_iron,
minerals_magnesium,
minerals_manganese,
minerals_phosphorus,
minerals_potassium,
minerals_selenium,
minerals_sodium,
minerals_zinc,
other_alcohol,
other_cost,
other_water,
other_weight,
phytonutrients_anthocyanins,
phytonutrients_caffeine,
phytonutrients_beta_carotene,
phytonutrients_carotenoids,
phytonutrients_flavanols,
phytonutrients_flavanones,
phytonutrients_flavones,
phytonutrients_flavonoids,
phytonutrients_flavonols,
phytonutrients_isoflavones,
phytonutrients_lutein_zeaxanthin,
phytonutrients_lycopene,
phytonutrients_phytosterols,
phytonutrients_theobromine,
protein_complete,
protein_total,
vitamins_vitamin_a,
vitamins_vitamin_b12,
vitamins_vitamin_b6,
vitamins_vitamin_c,
vitamins_choline,
vitamins_vitamin_d,
vitamins_vitamin_e,
vitamins_folate,
vitamins_vitamin_k,
vitamins_niacin,
vitamins_pantothenic_acid,
vitamins_riboflavin,
vitamins_thiamin,
carbohydrates_digestible,
energy_carbohydrate,
energy_fat,
energy_fat_and_carbohydrate,
energy_protein,
energy_alcohol,
energy_digestible,
fats_hcsfa,
fats_lcn3pufa
FROM DnMixResult a,
     food b
WHERE a.mix_id = v_mixid
AND   a.food_id = b.foodid
--
union
--
select
a.mix_id,
'',
'Total',
sum(carbohydrates_carbs_by_diff),
sum(carbohydrates_fiber_insoluble),
sum(carbohydrates_fiber_soluble),
sum(carbohydrates_fiber),
sum(carbohydrates_fructose),
sum(carbohydrates_glucose),
sum(carbohydrates_glycemic_load),
sum(carbohydrates_lactose),
sum(carbohydrates_starch),
sum(carbohydrates_sucrose),
sum(carbohydrates_sugars),
sum(energy_gross),
sum(fats_cholesterol),
sum(fats_dha),
sum(fats_epa),
sum(fats_lauric),
sum(fats_linoleic),
sum(fats_linolenic),
sum(fats_monounsaturated),
sum(fats_myristic),
sum(fats_palmitic),
sum(fats_polyunsaturated),
sum(fats_saturated),
sum(fats_stearic),
sum(fats_total),
sum(minerals_calcium),
sum(minerals_copper),
sum(minerals_iron),
sum(minerals_magnesium),
sum(minerals_manganese),
sum(minerals_phosphorus),
sum(minerals_potassium),
sum(minerals_selenium),
sum(minerals_sodium),
sum(minerals_zinc),
sum(other_alcohol),
sum(other_cost),
sum(other_water),
sum(other_weight),
sum(phytonutrients_anthocyanins),
sum(phytonutrients_caffeine),
sum(phytonutrients_beta_carotene),
sum(phytonutrients_carotenoids),
sum(phytonutrients_flavanols),
sum(phytonutrients_flavanones),
sum(phytonutrients_flavones),
sum(phytonutrients_flavonoids),
sum(phytonutrients_flavonols),
sum(phytonutrients_isoflavones),
sum(phytonutrients_lutein_zeaxanthin),
sum(phytonutrients_lycopene),
sum(phytonutrients_phytosterols),
sum(phytonutrients_theobromine),
sum(protein_complete),
sum(protein_total),
sum(vitamins_vitamin_a),
sum(vitamins_vitamin_b12),
sum(vitamins_vitamin_b6),
sum(vitamins_vitamin_c),
sum(vitamins_choline),
sum(vitamins_vitamin_d),
sum(vitamins_vitamin_e),
sum(vitamins_folate),
sum(vitamins_vitamin_k),
sum(vitamins_niacin),
sum(vitamins_pantothenic_acid),
sum(vitamins_riboflavin),
sum(vitamins_thiamin),
sum(carbohydrates_digestible),
sum(energy_carbohydrate),
sum(energy_fat),
sum(energy_fat_and_carbohydrate),
sum(energy_protein),
sum(energy_alcohol),
sum(energy_digestible),
sum(fats_hcsfa),
sum(fats_lcn3pufa)
FROM DnMixResult a,
food b
WHERE a.mix_id = v_mixid
AND   a.food_id = b.foodid
group by a.mix_id
order by a.energy_digestible,a.other_weight,b.name;
--
OPEN result;
END;
/